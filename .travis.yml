language: node_js
node_js:
- '8'
env:
  global:
  - ORG="phi-grib"
  - REPO="DjangoAPI"
  - GH_REPO="github.com/${ORG}/${REPO}.git"
  - secure: GgwnfGx918B21//WI9cY7BDhv75EP2yfy/4URRTAUM90R/91JkBTFk7ogH+iT/lgvKXN+VaIOGKwarHJgc/HJyf1QiOdRgqpUmncs1KRiZ3loYEO6PwuxOvbVxOnMRxNTPjphF7sLK7MIzLtrQ84pAbyAeRTB9jg07iqA2ZCFzm0kRLTXD0qYui/XBcQ7ZdqARa5kAKDAtzYEeKStGkg6Iqje7MaqPVPd9cgml2r9Ml+UWQ0mpFO5oZgAgEFm5+8wF2ECxVfBcKPOCWgK8s/83qE01mWy9jzkdcP+rWvYKNZ1IEzlvX0aZlLJuzHKM5MHM1B7110O2jxeEDCjD7CGxH5el31oO9QQyekc9NUB9hNe6Oy6fUuywAnC02mFmn7iyfiYonE0DztPtlxEmvzoQV676/tOnT2XXcFWofWCgynN4K0baXtdOVmJUdhEkEy2tDS1042pLq5PWN/+g930Eo30ujrpH1khfOH1StTBf/Ame/O3KnCwNzMlATjHmvgRIpUgBNR0ocF/+LstXc10KoUbvCGrUxlCuF2ZWhGepdv6Jylypi10fefJCjo05Mk5lMhJFOE82QRhY8ZWhdUyaiIXKoDftZoBqFx7Y0QlvC7URhvc5i2571Yi+yPWgWLkUluliT0KAYiixtTnwlBl7j3DlgFQZM4Zx5JX2S3qRU=
before_script:
- npm install -g @angular/cli
script:
- ng build --prod --aot  --output-hashing none
after_success:
- MESSAGE=$(git log --format=%B -n 1 $TRAVIS_COMMIT)
- git clone https://github.com/phi-grib/DjangoAPI.git
- pwd
- ls -l
- rm -rfv ./DjangoAPI/static/*
- cd DjangoAPI/
- git remote
- git config user.email ignacio.pasamontes@upf.edu
- git config user.name IgnacioPasamontes
- git rm static/*
- git commit -m 'BUILD:Remove statics'
- git push "https://${SOMEVAR}@${GH_REPO}"



- mkdir static
- mv -f ../dist/frontend/* ./static
- git remote
- git config user.email ignacio.pasamontes@upf.edu
- git config user.name IgnacioPasamontes
- git add static/*
- git commit -m 'BUILD:ADD statics'
- git push "https://${SOMEVAR}@${GH_REPO}"
