language: node_js
node_js:
- '8'
env:
  global:
  - ORG="phi-grib"
  - REPO="DjangoAPI"
  - GH_REPO="github.com/${ORG}/${REPO}.git"
  secure: "oO4GCgLyIptVQx55sowdbAPApwxgBZjsEhYu4epoS2YN5+9oX6HWDOKJ76hyy9mViqTchOI5Um9rxnzIYMqnl2SFZyopMyb92mfxNuJgGzbzSHe3suJlX6XkCkIo2O1wfkdRLPcoRBsP223/BFGrb5c8cEj+TybHUY7LQ1vhNTmO8aSzeKKnCB3GaLyOFPih65VCFCIb4CRsKfCxf3IirpkVBELwTwH9nkYZ/214TWGJPUgPvX2/5iyi4oQZWTsqAX+SM1dwcC8U/jVM0TnJZYYLBwxGpg2/KTVGr+DiZTVpPtTWyTQ4aVTMFWDv7MkmaziLjk19XWcnZhJyNl1uxZW5r1LfO1Hrj4dOByKuT1aK1uO4/xXPgIHubAArl2DkbNHFQXkeSff3MHDGqRcw81BHwG3YKuevvETj1CFzkvQNxcyr3hzPQr56H0rmGVE5FEZjz2G30dz4o8X6LtWRoKWsEjlcUrdjhpx1z6WWdmDMMKL4npX7/YeqLNMUrHB1SlZYmHLH+i74Do0tc06lfSFLgo8pK6TDe2mJ9/PTv51ME0lB3RefpYQM5bUbYIVFD/VG5Gy0gh89qmfroBEiIFI/6TGBjsBNOHRYL667AFjCluNyajiSMK1p9LcMlBGF4AAslNoT+pVQ2gYsZ0SrOvjWYqUUVDZgjlmGde67E9o="
before_script:
- npm install -g @angular/cli
script:
- ng build --prod --aot  --output-hashing none
after_success:
- MESSAGE=$(git log --format=%B -n 1 $TRAVIS_COMMIT)
- git clone https://github.com/phi-grib/DjangoAPI.git
- pwd
- ls -l
- rm -rfv ./DjangoAPI/static/*
- cd DjangoAPI/
- git remote
- git config user.email "ignacio.pasamontes@upf.edu"
- git config user.name "IgnacioPasamontes"
- git rm static/*
- git commit -m 'BUILD:Remove static'
- git push "https://${SOMEVAR}@${GH_REPO}"
- mkdir static
- mv -f ../dist/frontend/* ./static
- git remote
- git config user.email "ignacio.pasamontes@upf.edu"
- git config user.name "IgnacioPasamontes"
- git add static/*
- git commit -m 'BUILD:ADD static'
- git push "https://${SOMEVAR}@${GH_REPO}"
- ls -l
- pwd
