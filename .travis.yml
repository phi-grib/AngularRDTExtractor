language:  node_js
node_js:
  - "8"
env:
  global:
  - USER="IgnacioPasamontes"
  - EMAIL="ignacio.pasamontes@upf.edu"
  - ORG = "phi-grib"
  - REPO="./DjangoAPI"
  - FILES="./dist/frontend/*"
  - GH_REPO="github.com/${ORG}/${REPO}.git"
  #- secure: "put travis gem output here => http://docs.travis-ci.com/user/encryption-keys/"
before_script:
  - npm install -g @angular/cli

script:
  - ng build --prod --aot  --output-hashing none
  #- ng test
after_success:
  
  - git clone https://github.com/phi-grib/DjangoAPI.git
  - rm -rfv ./DjangoAPI/static/*
  - cd DjangoAPI/
  - git rm static/*
  - git remote
  - git config user.email ${EMAIL}
  - git config user.name ${USER}
  - git commit -m 'BUILD:Remove statics' 
  - git push
  - mkdir static

  - mv -f ../dist/frontend/* ./static
  - git add ./static
  - mv -f ../dist/frontend/* ./static/*
  - git add static/*
  - git remote
  - git config user.email ${EMAIL}
  - git config user.name ${USER}
  - git commit -m ''BUILD:Add statics' 
  - git push
  #- git push "https://${TRAVIS_SECURE_TOKEN_NAME}@${GH_REPO}" master > /dev/null 2>&1
