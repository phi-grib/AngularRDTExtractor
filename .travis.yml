language: node_js
node_js:
- '8'
env:
  global:
  - ORG="phi-grib"
  - REPO="DjangoAPI"
  - GH_REPO="github.com/${ORG}/${REPO}.git"
  - secure: h327vg/1ILQm7hSBtIt9sprOv0ckmqIlymIP+RiSVGozgltyXRz3+o0MwSYROc8Xyd5WPzoObHXI5UTIr+/YS29wvj8zFg7iW2PANZmf/xnzI/l7Dyj22GPLAtx48BOvlaoilyFP51P2m0dUzFvI970eVVyWfDgXRilc9R+CSYpi2b5H3+jtAt7wVwgKa+9wlS2Peod/0lQZisA7HB/vjBooew2gsvzYprtecu3JwpxgbJUHC7HkoFOb1+QLdm6njknwlTdMffaBMc8pazAXNSGD+knPYbRcAdcf0hlXs4C4EwOGuvIdmlg2GwGsF+C1STN4GrJgTy3/T6MTay0Wn/+rc2AKmo3vSXmD8SxTLqjIWqWu/3sF04oY5h5qBOwuM9ne6C4KHIxuPJs6C4ybxbh3J8PAXLmz0z778jZ61UdoqRNHWWNl0O0G/9C50g1WK+kzcugP6Mxa9pCATFK3p/h5tTLVrtx/1/Yyb99HH82BBOrLylIo9hIllVRsuaH9zFoAGS2foGM1l3EqZzTH3h1agDsJ2OZNIvfjh8RMoH/qFee61UPlyvUA0OqKg5nJA4izilYlWStphrQuGiyEIoezAwiS2M+K5ixOkS+h4jcjTJls605VhRdTt7kKJR0mpVC94y6hWZL6wwkV20qNZpB9pQ++84HO1Y8tp/vxrdI=
before_script:
- npm install -g @angular/cli
script:
- ng build --prod --aot  --output-hashing none
after_success:
- MESSAGE=$(git log --format=%B -n 1 $TRAVIS_COMMIT)
- git clone https://github.com/phi-grib/DjangoAPI.git
- pwd
- ls -l
- rm -rfv ./DjangoAPI/static/*
- cd DjangoAPI/
- git remote
- git config user.email ignacio.pasamontes@upf.edu
- git config user.name IgnacioPasamontes
- git rm static/*
- git commit -m 'BUILD:Remove static'
- git push "https://${SOMEVAR}@${GH_REPO}"
- mkdir static
- mv -f ../dist/frontend/* ./static
- git remote
- git config user.email ignacio.pasamontes@upf.edu
- git config user.name IgnacioPasamontes
- git add static/*
- git commit -m 'BUILD:ADD static'
- git push "https://${SOMEVAR}@${GH_REPO}"
