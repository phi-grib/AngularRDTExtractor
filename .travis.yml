language: node_js
node_js:
- '8'
env:
  global:
  - ORG="phi-grib"
  - REPO="DjangoAPI"
  - GH_REPO="github.com/${ORG}/${REPO}.git"
  - secure: gShioyv0yugwgl7Dwg7cSm4XM3M0+oesHVr6t4+5+BC3IjDLFj1DOEqDbJdJ2BLYqI1Wk/vP5ysK2AHa+IgboC3szntCLab9Im5MZM4ClIgQ+QQTuWlWyazmNqjteRI6zRmi5kg2g9qufmjFpAuEIla1AueDZImUKSIzTRoFKe6xBPBnuLRG1DCD+q/nMsU0tEEMTGcLFVyq4rkHKztmdP1Q7GJ/HVAAIf4RdW5npLmpYWmQVJy4qs8lhruI9bn2JT2Sze5Nq4Wr7v3+pGmzVptjG6YLpdFcbhKFmr3nTH9Asz3hRr1FvdIsOu8hEvNl0QzlBDBXPBzb4+MEo4AevPLWFbjaj8Bmxwkq3y5Im7u8RYf38RkR2NlRRq4rRt/prtjbvAuGdJoHPz+e2pVEWpkQHefWKr4z977s70fzoQzPbdpADYgkWK6lwtKX5xR8Q1e+2hii8S6Kid72OTcpJq0OHLcuKeeYvD859QbyWus/Jqx3ByaK8uAViqamonewIQqe+2+6n1UqJMov7ujccIaj5ftGcGZwYyV2a9llOinMlrUaeetmNbJVN+jsxT7KAGzpcySv1aZdXZftqgL7D1dxNC5+zdwjTzhBgpBF4Oy7aifBzQLbWpfrenZe5jWd+OFfqjYzqUKNgQ6ursJO8Gwp48wi0ayzOGqnksbBL04=
before_script:
- npm install -g @angular/cli
script:
- ng build --prod --aot  --output-hashing none
after_success:
- MESSAGE=$(git log --format=%B -n 1 $TRAVIS_COMMIT)
- git clone https://github.com/phi-grib/DjangoAPI.git
- pwd
- ls -l
- rm -rfv ./DjangoAPI/static/*
- cd DjangoAPI/
- git remote
- git config user.email "ignacio.pasamontes@upf.edu"
- git config user.name "IgnacioPasamontes"
- git rm static/*
- git commit -m 'BUILD:Remove static'
- git push "https://SOMEVAR@${GH_REPO}"
- mkdir static
- mv -f ../dist/frontend/* ./static
- git remote
- git config user.email "ignacio.pasamontes@upf.edu"
- git config user.name "IgnacioPasamontes"
- git add static/*
- git commit -m 'BUILD:ADD static'
- git push "https://SOMEVAR@${GH_REPO}"
- ls -l
- pwd
