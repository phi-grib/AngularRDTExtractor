language: node_js
node_js:
- '8'
env:
  global:
  - ORG="phi-grib"
  - REPO="DjangoAPI"
  - GH_REPO="github.com/${ORG}/${REPO}.git"
  secure: 
  - SOMEVAR="a5LrkmMH5NGvU1I0tt/KndU4O3nIhCeWhWWQxShqdlwSpQJQNomTcl+o7pKoCKBRi+Nmdkku+zlO14Kx6qYMyGnNQrkcxgaGKjNUvl2LQ8wEP8n9W06jyMRX2PRWtAmxLEoUbuocRTlQRmlzadP51Bb6ZYNr7DtcuNcpeC1pv0454RA8bs2ZCFTDxtBW9YgBuGXQrcId24j7nd0qrB7Wl5EN29YGzarFC/lL4Y6VTxIeHt0bUAtmJil0HJmuBKq5XR5zC4JA8FHoxRRMBH5Kc6/ppf926B8A9aPcXYYFaGsrqg1RpWt6USG9r5TwtIlqc1INd2QbsZc3TFHy6RzwMrIkplB0rlNk6vQ0/NjpPJInT2kHnDp75IJe+U/0VZv9O8z1WNF79jH1Q3wiXOOAUvFqnLnfsPDV1/3kX2t+1WHupcJpA/QU8n7VNyYb0um/DIrnz9WauT8otMrIA/Ng15o/8X26Cdu/U2vy4HTipeu1dphzNADKqv6ARHw01x+4aahm6qEQ/DK5fbVPSOEQKcgk1QYLun9fzl87Gl2hyBzl4MlEk9uIX1491zIuFGQxhelKMWtp2X4wEeZdzUIssXWVy3pOsRy3QUMoDnoLkEnyciwYqN60CNuViJVEY2rGVlPVpJKhsTkba7I0CddoOWAJr/v4i9ZLUpa9y9jMJIc="
before_script:
- npm install -g @angular/cli
script:
- ng build --prod --aot  --output-hashing none
after_success:
- MESSAGE=$(git log --format=%B -n 1 $TRAVIS_COMMIT)
- git clone https://github.com/phi-grib/DjangoAPI.git
- pwd
- ls -l
- rm -rfv ./DjangoAPI/static/*
- cd DjangoAPI/
- git remote
- git config user.email ignacio.pasamontes@upf.edu
- git config user.name IgnacioPasamontes
- git rm static/*
- git commit -m 'BUILD:Remove static'
- git push "https://${SOMEVAR}@${GH_REPO}"
- mkdir static
- mv -f ../dist/frontend/* ./static
- git remote
- git config user.email ignacio.pasamontes@upf.edu
- git config user.name IgnacioPasamontes
- git add static/*
- git commit -m 'BUILD:ADD static'
- git push "https://${SOMEVAR}@${GH_REPO}"
